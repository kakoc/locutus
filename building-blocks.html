<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Building Blocks - Freenet Manual</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="dev-guide.html"><strong aria-hidden="true">2.</strong> Development Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="manifest.html"><strong aria-hidden="true">2.1.</strong> Manifest Format</a></li><li class="chapter-item expanded "><a href="docker.html"><strong aria-hidden="true">2.2.</strong> Building with Docker</a></li></ol></li><li class="chapter-item expanded "><a href="contract-interface.html"><strong aria-hidden="true">3.</strong> Contract Interface</a></li><li class="chapter-item expanded "><a href="building-blocks.html" class="active"><strong aria-hidden="true">4.</strong> Building Blocks</a></li><li class="chapter-item expanded "><a href="glossary.html"><strong aria-hidden="true">5.</strong> Glossary</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Freenet Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-building-blocks-of-decentralized-software"><a class="header" href="#the-building-blocks-of-decentralized-software">The Building Blocks of Decentralized Software</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>To illustrate the primitives of decentralized software, we will use the
Antiflood Token System (AFT) as an example.</p>
<p>The AFT is a decentralized system aimed at combating flooding,
denial-of-service attacks, and spam. AFT operates by allowing users to generate
tokens through a &quot;token generator&quot; by completing a &quot;hard&quot; task, such as making
a donation to Freenet. Tokens are generated at a fixed rate and can be utilized
to perform activities, such as sending messages.</p>
<p>The recipient can specify the required token &quot;tier,&quot; with each tier being
generated at different intervals (e.g. 1 minute, 1 hour). This way, if a
recipient experiences a high volume of messages, they can increase the token
tier to make it more challenging to generate, thus reducing the flood.</p>
<h2 id="primitives"><a class="header" href="#primitives">Primitives</a></h2>
<h3 id="applications"><a class="header" href="#applications">Applications</a></h3>
<p>This is the user interface that wishes to use the AFT system to send a message,
for example a decentralized instant messaging system. Applications will
typically run in a web browser and either implemented in JavaScript or
WebAssembly.</p>
<h3 id="delegates"><a class="header" href="#delegates">Delegates</a></h3>
<p>Delegates are webassembly code that act as intermediaries between the user and
various digital entities such as contracts, apps, and other delegates. They
perform tasks, store secrets, perform cryptographic operations, and communicate
with the user for permission to perform specific actions. They are like a much
more powerful version of cookies or local storage in a web browser. Delegates
can be created by applications or other delegates, with the user's permission.
Delegates implement the
<a href="https://github.com/freenet/locutus/blob/f1c8075e173f171c17ffa8d08803b2c9aea4ddf3/crates/locutus-stdlib/src/component_interface.rs#L121">DelegateInterface</a>.</p>
<p>The AFT relies on a
<a href="https://github.com/freenet/locutus/blob/f1c8075e173f171c17ffa8d08803b2c9aea4ddf3/modules/antiflood-tokens/components/token-generator/src/lib.rs#L17">TokenDelegate</a>
that implements this DelegateInterface.</p>
<h3 id="contracts"><a class="header" href="#contracts">Contracts</a></h3>
<p>Contracts are webassembly code implementing the
<a href="https://github.com/freenet/locutus/blob/f1c8075e173f171c17ffa8d08803b2c9aea4ddf3/modules/antiflood-tokens/contracts/token-allocation-record/src/lib.rs#L10">ContractInterface</a>.</p>
<h4 id="token-generator"><a class="header" href="#token-generator">Token Generator</a></h4>
<p>The
<a href="https://github.com/freenet/locutus/blob/f1c8075e173f171c17ffa8d08803b2c9aea4ddf3/modules/antiflood-tokens/contracts/token-allocation-record/src/lib.rs#L10">TokenAllocContract</a>
keeps track of token assignments to ensure that tokens are not double spent.
New tokens are generated at a fixed rate that depends on the tier required by
the recipient.</p>
<h4 id="recepient-inbox"><a class="header" href="#recepient-inbox">Recepient Inbox</a></h4>
<p>The recipient inbox contract keeps track of inbound messages sent to a
recipient, verifying that each is accompanied by a valid token of the required
tier.</p>
<h2 id="sequence-diagram"><a class="header" href="#sequence-diagram">Sequence Diagram</a></h2>
<pre class="mermaid">sequenceDiagram
  participant User
  participant Application
  participant Delegate
  participant TokenGeneratorContract
  participant RecipientInboxContract

  User-&gt;&gt;Application: 1. RequestToken
  Application-&gt;&gt;Delegate: 2. RequestToken
  Delegate-&gt;&gt;User: 3. Allocate?
  User-&gt;&gt;Delegate: 4. approved
  Delegate-&gt;&gt;TokenGeneratorContract: 5. TokenAllocation
  Delegate-&gt;&gt;RecipientInboxContract: 6. Message+TokenAllocation
  RecipientInboxContract-&gt;&gt;TokenGeneratorContract: 7. verify
  TokenGeneratorContract-&gt;&gt;RecipientInboxContract: 8. verified
</pre>
<ol>
<li>
<p>User requests a token from the application, perhaps by composing a message
and clicking &quot;send&quot; in the UI</p>
</li>
<li>
<p>The application requests a token from the delegate via its websocket
connection to the Freenet node</p>
</li>
<li>
<p>The delegate requests permission from the user to allocate a token, this
occurs independently of the application, perhaps via an OS-specific
notification mechanism</p>
</li>
<li>
<p>The user approves the allocation</p>
</li>
<li>
<p>The delegate allocates a token to the token generator contract</p>
</li>
<li>
<p>The delegate sends the message and token allocation to the recipient inbox
contract</p>
</li>
<li>
<p>The recipient inbox contract verifies that the token allocation is valid
before appending the inbound message to its state</p>
</li>
<li>
<p>The token generator contract verifies that the token allocation is valid and
adds it to its list of allocations</p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="contract-interface.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="glossary.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="contract-interface.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="glossary.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>


    </div>
    </body>
</html>
